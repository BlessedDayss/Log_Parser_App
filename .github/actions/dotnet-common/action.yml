# .github/actions/dotnet-common/action.yml

name: dotnet-common
description: Shared .NET SDK, tools install, and NuGet caching

runs:
  using: composite
  steps:
    - name: Setup .NET SDK
      uses: actions/setup-dotnet@v4
      with:
        dotnet-version: ${{ env.DOTNET_VERSION }}

    - name: Cache NuGet packages
      uses: actions/cache@v4
      with:
        path: |
          ~/.nuget/packages
          ~/.dotnet/tools/.store
        key: nuget-${{ runner.os }}-${{ hashFiles('**/*.csproj') }}

    - name: Install global tools
      shell: pwsh
      run: |
        # Правильный пакет для GitVersion:
        dotnet tool install --global GitVersion.Tool
        dotnet tool install --global dotnet-sonarscanner

    - name: Add .NET global tools to PATH (Windows)
      if: runner.os == 'Windows'
      shell: pwsh
      run: |
        Add-Content -Path $Env:GITHUB_PATH -Value "$Env:USERPROFILE\.dotnet\tools"

    - name: Add .NET global tools to PATH (Linux/Mac)
      if: runner.os != 'Windows'
      run: |
        echo "${HOME}/.dotnet/tools" >> $GITHUB_PATH
